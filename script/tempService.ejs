'use strict';

const <%=table %>Module = require(rootPath.concat("/module/<%=table%>Module.js"));
const logger = log4js.getLogger('system');

exports.select = (req,res,next) => {
    let conn;
    Promise.coroutine(function* () {
        conn = yield util.getConnect();
        let result = yield <%=table %>Module.select(conn,req.query);
        return res.json(util.success( {data:result} ));
    })().catch(( err )=> {
        logger.error(err.stack);
        return res.json(config.message.error);
    }).finally(()=> {
        conn.release();
    });
}

exports.get = (req,res,next) => {
    let conn;
    Promise.coroutine(function* () {
        conn = yield util.getConnect();
        let result = yield <%=table%>Module.get(conn,req.params);
        return res.json(util.success( {data:result} ));
    })().catch(( err )=> {
        logger.error(err.stack);
        return res.json(config.message.error);
    }).finally(()=> {
        conn.release();
    });
}

exports.add = (req,res,next) => {
    let conn;
    Promise.coroutine(function* () {
        conn = yield util.getConnect();
        yield <%=table%>Module.add(conn,req.body);
        return res.json(config.message.success);
    })().catch(( err )=> {
        logger.error(err.stack);
        return res.json(config.message.error);
    }).finally(()=> {
        conn.release();
    });
}

exports.update = (req,res,next) => {
    let conn;
    Promise.coroutine(function* () {
        conn = yield util.getConnect();
        yield <%=table%>Module.update(conn,req.body,req.params);
        return res.json(config.message.success);
    })().catch(( err )=> {
        logger.error(err.stack);
        return res.json(config.message.error);
    }).finally(()=> {
        conn.release();
    });
}

exports.delete = (req,res,next) => {
    let conn;
    Promise.coroutine(function* () {
        conn = yield util.getConnect();
        yield <%=table%>Module.delete(conn,req.params);
        return res.json(config.message.success);
    })().catch(( err )=> {
        logger.error(err.stack);
        return res.json(config.message.error);
    }).finally(()=> {
        conn.release();
    });
}